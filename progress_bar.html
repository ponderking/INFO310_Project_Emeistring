<!DOCTYPE html>
<html lang="en"> <head>
    <meta charset="utf-8">
    <title>eMeistring - Progress Bar for Individual Patients</title>
    <script type="text/javascript" src="d3/d3.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!--    <link rel="stylesheet" href="css/dashboard.css"> -->
</head>
<body>
<script>


// I start handling our patient data here:

    console.log("hello outside loop")
    d3.json("data/patient_data.json", function(data) {

        var amount_of_modules = data.modules.length
        console.log(amount_of_modules)


    // progress-bar code:
    // code currently from: http://bl.ocks.org/vkuchinov/c43323186765cb14ddd292e71790f0ec

        var colors = { green: '#4DC87F', lightGreen: '#D9F0E3', white: '#FFFFFF', black: '#000000'};
        var width = 960, height = 480, offset = 48;

        width += offset * 2;
        height += offset * 2;
        var dimensions = '' + 0 + ' ' + 0 + ' ' + width + ' ' + height;

        var svg = d3.select('body').append('svg')
            .attr('id', 'scene', true)
            .attr('preserveAspectRatio', 'xMinYMin meet')
            .attr('viewBox', dimensions)
            .classed('svg-content', true);

        // var steps = ['0', '1', '2', '3', '4', '5'];
        var steps = [];
        for (var i = 1; i <= amount_of_modules; i++) {
            steps.push(i);
        }
        stepWidth = (width - offset * 2) / (steps.length - 1),
            currentStep = '0';

        var progressBar = svg.append('g')
            .attr('transform', 'translate(' + offset + ',' + offset + ')')
            .style('pointer-events', 'none');

        var progressBackground = progressBar.append('rect')
            .attr('fill', colors.lightGreen)
            .attr('height', 8)
            .attr('width', width - offset * 2)
            .attr('rx', 4)
            .attr('ry', 4);

        // var progress = progressBar.append('rect')
        //     .attr('fill', colors.green)
        //     .attr('height', 8)
        //     .attr('width', 0)
        //     .attr('rx', 4)
        //     .attr('ry', 4);
        //
        // progress.transition()
        //     .duration(1000)
        //     .attr('width', function(){
        //         var index = steps.indexOf(currentStep);
        //         return (index + 1) * stepWidth;
        //     });

        progressBar.selectAll('circle')
            .data(steps)
            .enter()
            .append('circle')
            .attr('id', function(d, i){ return 'step_' + i; })
            .attr('cx', function(d, i){ return i * stepWidth; })
            .attr('cy', 4)
            .attr('r', 30)
            .attr('fill', '#FFFFFF')
            .attr('stroke', colors.lightGreen)
            .attr('stroke-width', 6)
            .on("click", function(){
                console.log("Click Worked!")
                d3.select(this).style("stroke", colors.black);
            });


        progressBar.selectAll('text')
            .data(steps)
            .enter()
            .append('text')
            .attr('id', function(d, i){ return 'label_' + i; })
            .attr('dx', function(d, i){ return i * stepWidth; })
            .attr('dy', 10)
            .attr('text-anchor', 'middle')
            .text(function(d, i) { return i + 1; })

        

        // updateProgressBar("0");

        // //self-running demo
        // setInterval(function() { updateProgressBar(Math.floor(Math.random() * (steps.length - 1)).toString()); } , 2500)
        //
        // function setupProgressBar(data_){
        //
        //     var output = [];
        //     for(var i = 0; i < data_.length; i++){ output.push(data_[i].id.toString()); }
        //     return output;
        //
        // }

        // function updateProgressBar(step_){
        //
        //     progress.transition()
        //         .duration(1000)
        //         .attr('fill', colors.green)
        //         .attr('width', function(){
        //             var index = steps.indexOf(step_);
        //             return (index) * stepWidth;
        //         });
        //
        //     for(var i = 0; i < steps.length; i++){
        //
        //         if(i <= steps.indexOf(step_)) {
        //
        //             d3.select('#step_' + i).attr('fill', colors.green).attr('stroke', colors.green);
        //             d3.select('#label_' + i).attr('fill', '#FFFFFF');
        //
        //
        //         } else {
        //
        //             d3.select('#step_' + i).attr('fill', '#FFFFFF').attr('stroke', colors.lightGreen);
        //             d3.select('#label_' + i).attr('fill', '#000000');
        //
        //         }
        //
        //     }
        //
        // }
        data = data.modules
        for (var i = 0; i < data.length; i++) {
            console.log(data[i].patient_data[0].madris_score);
            var madris_score = data[i].patient_data[0].madris_score
            d3.select('body').append('p').text("madris_score patient 1 (test):" + madris_score);
        }
    // end of d3.json() callback
    });

</script>
</body>
</html>




